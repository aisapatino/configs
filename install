#!/usr/bin/env bash

# Set up config files using symlinks, overwriting/creating directories as needed.
#
# Execute with an argument to specify install type: ./install work|linux
# Otherwise it will default to base install.

red="\033[31m"
green="\033[32m"
yellow="\033[33m"
cyan="\033[36m"
bold="\033[1m"
reset="\033[m"

run_setup() {
  local header="\n${bold}%s${reset}\n==========\n\n"
  local configs=~/Projects/configs

  # Determine install type
  #------------------------

  if [[ $1 == m* ]] || [[ $1 == w* ]] ; then # "mac" or "work"
    local install_type='work'
    local work=1
  elif [[ $1 == l* ]] || [[ $1 == h* ]] ; then # "linux" or "home"
    local install_type='linux'
    local linux=1
  else
    install_type='base'
  fi

  echo -e "\nRunning $bold$install_type$reset setup..."

  # Git
  #-----

  printf "$header" "Git config"

  ln -fsv "$configs/git/.gitignore" ~
  ln -fsv "$configs/git/.gitconfig" ~
  ln -fsv "$configs/git/.gitk"      ~

  if [ ! -f ~/.git-completion.bash ]; then
    echo "Getting git-completion.bash"
    curl -o ~/.git-completion.bash \
      https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash
  fi
  if [ ! -f ~/.git-prompt.sh ]; then
    echo "Getting git-prompt.sh"
    curl -o ~/.git-prompt.sh \
      https://raw.githubusercontent.com/git/git/master/contrib/completion/git-prompt.sh
  fi

  # Terminal
  #----------

  printf "$header" "Terminal"

  ln -fsv "$configs/terminal/.inputrc"            ~
  ln -fsv "$configs/terminal/.bash_profile"       ~
  if [ $work ] ; then
    ln -fsv "$configs/terminal/.bashrc-work"      ~/.bashrc
  elif [ $linux ] ; then
    mkdir -pv ~/.config/terminator
    ln -fsv "$configs/terminal/terminator-config" ~/.config/terminator/config
    ln -fsv "$configs/terminal/.bashrc-linux"     ~/.bashrc
  else
    ln -fsv "$configs/terminal/.bashrc-base"      ~/.bashrc
  fi

  # Other
  #-------

  if [ $linux ] ; then
    printf "$HEADER" "lint"
    ln -fsv "$configs/other/.pylintrc" ~
    ln -fsv "$configs/other/.eslintrc" ~
  fi

  printf "$header" "ag and ctags"

  ln -fsv "$configs/other/.agignore" ~
  ln -fsv "$configs/other/.ctags"    ~

  # Vim
  #-----

  printf "$header" "vim"

  ln -fsv "$configs/vim/.vimrc"  ~
  ln -fsv "$configs/vim/.gvimrc" ~

  if [ ! -f ~/.vim/autoload/plug.vim ] ; then
    echo "Downloading vim-plug"
    curl -Lo ~/.vim/autoload/plug.vim --create-dirs \
       https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
  fi

  mkdir -pv ~/.vim
  ln -fsv "$configs/vim/colors"              ~/.vim
  ln -fsv "$configs/vim/custom-after"        ~/.vim
  ln -fsv "$configs/vim/custom-snippets"     ~/.vim
  ln -fsv "$configs/vim/filetype.vim"        ~/.vim

  echo -e "\n${bold}Make sure to run :PlugInstall once you open vim\n$reset"
}

run_setup $1
